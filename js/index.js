!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+68}const u=600,c=.125,r=.095,a=c,s=Math.min(c,.18,.235,r,a),f=1.5*u,m=1.5*u+u,g=Object.freeze({t:"NOT_STARTED",o:"IN_PROGRESS",i:"GAME_OVER",u:"READY_FOR_RESET"});function l(n,t=1/0){const e=[];let o=!1;function i(){if(o||0===e.length)return;o=!0;const{m:t,resolve:u,reject:c}=e.shift();Promise.resolve().then((()=>t())).then(u).catch(c).finally((()=>{setTimeout((()=>{o=!1,i()}),n)}))}return function(n){return e.length>=t?Promise.reject(Error("Queue size limit reached")):new Promise(((t,o)=>{e.push({m:n,resolve:t,reject:o}),i()}))}}function d(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function p(n){return Math.random()<n}function h(n,t){return Math.random()*(t-n)+n}function w(){return p(.5)}function y(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function M(n){const t=h(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function b(n,t){return n[M(t)]}function v(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function x(n){return-n.width<n.x&&n.x<o}function T(n,t){return t/n}function _(n,t,e,o){return n+t*o+.5*e*o*o}function k(n,t,e){return n+t*e}function S(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}function R(n){return S(n).catch(console.error)}async function E(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function A(n,t,e=1,o=1){if("running"===n.state){const i=n.createBufferSource();i.buffer=t,i.playbackRate.value=e;const u=n.createGain();u.gain.value=o,i.connect(u),u.connect(n.destination),i.start()}}function j(n,t,e,o,i,u,c=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*u),n.scale(c,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-u,i,u),n.restore()}const P="high-score";function O(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function I(){G().forEach(D),V().forEach(C),z().forEach(C),function(){const n=q();C(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".loading").classList.add("loading--completed")}function N(n){G().forEach(C),V().forEach(D),z().forEach(C),L().textContent=n}function F(n,t){G().forEach(C),V().forEach(C),z().forEach(D),function(){const n=B();C(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".game__result-score").textContent=n,document.querySelector(".game__result-best").textContent=t}function X(n){const t=document.querySelector(".game__canvas-container");t.classList.add("game__canvas-container--bg-"+n),setTimeout((()=>{t.classList.remove(...[0,1,2,3].map((n=>"game__canvas-container--bg-"+n))),H().style.backgroundImage=`url('../img/background-${n}.png')`}),2e3)}function Y(n){const[t,e]=O(),o=[q(),B()],u=t/n.width,c=e/n.height;o.forEach((t=>{const o=n.width/2+20,r=i(n)-16;t.style.left=o*u+"px",t.style.bottom=e-r*c+"px"}))}function C(n){n.style.visibility="hidden"}function D(n){n.style.visibility="visible"}function G(){return[document.querySelector(".game__title"),document.querySelector(".info-button"),q()]}function V(){return[L()]}function z(){return[document.querySelector(".game__result"),B()]}function H(){return document.querySelector(".game__canvas")}function L(){return document.querySelector(".game__score")}function q(){return document.querySelector(".game__start-hint")}function B(){return document.querySelector(".game__reset-hint")}const J=20,U=20,$=Math.floor(o/2)-J/2,Q=8*(o/3)/(u*u),K=-u*Q/2,W=2.5,Z=2.5,nn=-6,tn=0,en=1,on=2,un=3,cn=4,rn=.7,an=K,sn=250,fn=3e3,mn=180;function gn(){return{l:on,p:W,h:Z,M:0,width:J,height:U,x:$,y:5*-U,velocityY:0,v:!0,T:0,isFrozen:!0}}function ln(n){return i(n)-U}function dn(n){return n._.y===ln(n)}function pn(n){n.status!==g.o||n._.v||(n._.velocityY=K,n._.l=on,n._.v=!0,n._.T=n.k,A(n.S,y(n.A.R)))}function hn(n){n._.isFrozen||(n.status===g.t||n.status===g.o?(n._.v&&(wn(n),yn(n),function(n){n._.j&&!n._.v&&(pn(n),n._.j=!1)}(n)),function(n){if(!n._.v){const o=n.P.filter((n=>!n.O));if(o.length>0){const i=(t=o,e=n._.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),u=n._.p<0!==i.I;n._.p*=u?-1:1}}var t,e}(n)):n.status===g.i&&(wn(n),yn(n)))}function wn(n){var t,e,o;n._.velocityY=(t=n._.velocityY,e=Q,o=n.N,t+e*o),n._.y=_(n._.y,n._.velocityY,Q,n.N)}function yn(n){(function(n){return n._.y>ln(n)})(n)&&(n._.y=ln(n),n._.velocityY=0,n._.v=!1,n._.l=tn,n._.M=0,n.status===g.i&&(n._.l=cn))}function Mn(n){const t=h(sn,fn);n.F=setTimeout((()=>{n._.v||(n._.l=en),n.F=setTimeout((()=>{n._.v||(n._.l=tn),Mn(n)}),mn)}),t)}function bn(n){n._.velocityY=an,n._.l=un,function(n){clearTimeout(n.F)}(n)}const vn=10,xn=10,Tn=2.67,_n=2.67,kn=vn*Tn*.5,Sn=.4,Rn=3,En=1,An=.2,jn=.7;function Pn(n){return function(n,t){const e=i(n)-U/2-xn/2,u=n.X?a:r,c=T(kn,u)*Sn;return{p:Tn,h:_n,M:0,Y:t?c:-c,width:vn,height:xn,x:t?-vn:o,y:e,velocityX:t?u:-u,I:t,O:!1}}(n,w())}function On(n,t){if(n.status!==g.o)return;if(!p(n.X?jn:An))return;const e=Pn(n),o=function(n,t,e){const o=n+(t-n)*e,i=Math.random();return i<e?n+Math.sqrt(i*(t-n)*(o-n)):t-Math.sqrt((1-i)*(t-n)*(t-o))}(-f,m,.5);e.C=t-$/Math.abs(e.velocityX)+o,e.C<n.k?console.error("Cannot create future snack in the past. This should never happen. The caller has provided a jumpTime that is NOT far enough into the future."):n.D.push(e)}const In=10,Nn=10,Fn=$/s+f,Xn=2,Yn=2,Cn=.4,Dn=In*Xn*.5,Gn=[{l:0,velocityX:c,G:.85},{l:1,velocityX:.18,G:.95},{l:2,velocityX:.235,G:1.1}],Vn=[.45,.35,.2],zn=50,Hn=.8,Ln=.25,qn=.6,Bn=60;function Jn(n){return i(n)-U/2-Nn/2}function Un(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,u=i*i-4*o*-n;if(u<0)return null;{const n=Math.sqrt(u);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(Jn(n)-(ln(n)+U),K,Q))}function $n(n){const t=n.V.filter((t=>t.C<=n.k));var e,o,i;n.V=n.V.filter((t=>t.C>n.k)),n.P.push(...t),e=()=>{!function(n,t){const e=y(n.A.H),o=Math.max(...t.map((n=>n.G))),i=h(-.05,.05),u=o+i;A(n.S,e,u,qn)}(n,t)},o=Bn,(i=t.length)>0&&function n(t){e(t),t+1<i&&setTimeout((()=>n(t+1)),o)}(0)}function Qn(n){const t=function(n){function t(n){return n<1e4?[.1,.3,.6]:n<25e3?[.45,.4,.15]:n<4e4?[.65,.3,.05]:[.9,.1,0]}const e=[1*u,2.5*u,3.5*u],o=[2.5*u,3.5*u,7*u],i=M(t(n));return h(e[i],o[i])}(n.k-n.L);n.q=setTimeout((()=>{if(n.status!==g.o)return;const t=n.k+Fn;!function(n,t){const e=(f=n.k-n.L,f<7e3?1+M([.9,.1]):f<15e3?1+M([.7,.2,.05,.05]):f<3e4?1+M([.5,.2,.1,.1]):1+M([.4,.2,.15,.15,.05,.05])),i=function(n){const t=w(),e=b(Gn,Vn).velocityX;return d(n,(()=>{const o=p(Math.pow(Hn,1/n))?t:!t,i=p(Math.pow(Ln,1/n))?e:b(Gn,Vn).velocityX;return o?i:-i}))}(e),u=(s=i,s.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map)),c=new Map(i.map((e=>[e,Kn(n,t,e)]))),r=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(c,((n,[t,e])=>[n,function(n,t,e,o){const i=Math.floor((t-n)/o)+1,u=Math.min(e,i),c=function(n){const t=n.slice();for(let n=t.length-1;n>=0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t}(d(i,(n=>n))).slice(0,u).sort(((n,t)=>n-t));if(0===c.length)return[];const r=c[0],a=c[c.length-1],s=h(0,t-n-(a-r)*o);return c.map((t=>n+(t-r)*o+s))}(t,e,u.get(n),(In*Xn+2)/Math.abs(n))])),a=Array.from(r,(([t,e])=>e.map((e=>function(n,t,e){const i=Gn.find((n=>Math.abs(e)===n.velocityX)),u=e>=0,c=T(Dn,e)*Cn;return{C:t,l:i.l,p:Xn,h:Yn,M:0,Y:c,width:In,height:Nn,x:u?-In:o,y:Jn(n),velocityX:e,I:u,O:!1,G:i.G}}(n,e,t))))).flat();var s;var f;n.B.push(t),n.V.push(...a)}(n,t),On(n,t),Qn(n)}),t)}function Kn(n,t,o){const i=zn+e,c=Un(n),r=t+u-c-i,a=$+J+In;return[t+c+i-$/Math.abs(o),r-a/Math.abs(o)]}const Wn=4,Zn=400,nt=800,tt=60;function et(n){X(n.J),Y(n),I(),Mn(n),setTimeout((()=>{n._.isFrozen=!1}),2e3)}function ot(i){for(let n=i.U;n>0;n-=e)i.N=Math.min(n,e),i.k+=i.N,it(i),i.$+=1;i.K+=1,i.W-i.Z>=1e3&&(i.nn=i.K,i.tn=i.$,i.K=0,i.$=0,i.Z=i.W),function(e){(function(n){n.en.clearRect(0,0,o,n.height)})(e),function(n){j(n.en,n.images._[n._.l],n._.x,n._.y+nn,n._.width,n._.height,n._.p,n._.h,n._.M),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(n._.x,n._.y,J,U))}(e),function(n){for(const e of n.cn)j(n.en,n.images.rn,e.x,e.y,e.width,e.height,e.p,e.h,e.M),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.P)j(n.en,n.images.an[e.l],e.x,e.y,e.width,e.height,e.p,e.h,e.M),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(e.x,e.y,In,Nn))}(e),function(n){n.sn>0&&(n.en.fillStyle=`rgba(255, 255, 255, ${n.sn})`,n.en.fillRect(0,0,o,n.height))}(e),function(e){if(e.un){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.nn)+" F/S",Math.round(e.tn)+" U/S"].filter(Boolean).join("   ");e.en.font=n,e.en.fillStyle=t,e.en.fillText(i,8,e.height-8),e.en.strokeStyle=t,e.en.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.U=n-i.W,i.W=n,ot(i)}))}function it(n){!function(n){const t=n.B.length>0&&n.B[0]<=n.k;n.fn&&t&&(pn(n),n.B.shift())}(n),hn(n),$n(n),function(n){const t=n.D.filter((t=>t.C<=n.k)).filter((t=>{const e=(vn*Tn+4)/Math.abs(t.velocityX),o=[...n.P,...n.V].filter((n=>Math.abs(n.velocityX-t.velocityX)<Number.EPSILON));return[...n.cn,...o].every((n=>Math.abs(t.C-n.C)>=e))}));n.D=n.D.filter((t=>t.C>n.k)),n.cn.push(...t)}(n),function(n){for(const t of n.P)t.x=_(t.x,t.velocityX,0,n.N),t.M=k(t.M,t.Y,n.N)}(n),function(n){for(const t of n.cn)t.x=_(t.x,t.velocityX,0,n.N),t.M=k(t.M,t.Y,n.N)}(n),function(n){const t=n.mn;(function(n){if(n.X)return;if(n.status!==g.o)return;const t=n.P.filter((n=>{const t=!n.O,e=n.I&&n.x>$+J,o=!n.I&&n.x+In<$;return t&&(e||o)}));t.forEach((n=>n.O=!0)),n.mn+=t.length})(n),function(n){if(n.status!==g.o)return;const t=n.X?En:Rn,e=n.cn.filter((t=>{const e=!t.O,o=v(n._,t);return e&&o}));e.forEach((n=>n.O=!0)),n.cn=n.cn.filter((n=>!e.includes(n))),n.mn+=e.length*t}(n);const e=n.mn-t;for(let o=0;o<e;o++)n.gn((()=>{n.status===g.o&&(A(n.S,y(n.A.mn)),N(t+o+1))}))}(n),function(n){n.status===g.o?function(n){for(const t of n.P)if(v(n._,t))return!0;return!1}(n)&&(!function(n){n.mn>n.ln&&(n.ln=n.mn,t=n.mn,localStorage.setItem(P,t));var t}(n),function(n){clearTimeout(n.q)}(n),function(n){n.sn=1}(n),bn(n),n.status=g.i,A(n.S,n.A.dn)):n.status===g.i&&function(n){return 0===n.P.length&&0===n.cn.length}(n)&&(n.status=g.u,F(n.mn,n.ln))}(n),function(n){n.P=n.P.filter(x)}(n),function(n){n.cn=n.cn.filter(x)}(n),function(n){n.status===g.t&&dn(n)&&!n.pn?n.pn=setTimeout((()=>{n.status===g.t&&(!function(){const n=q();D(n),n.classList.add("spawn-and-shrug-bubble")}(),A(n.S,y(n.A.mn)))}),nt):n.status!==g.u||n.hn||(n.hn=setTimeout((()=>{n.status===g.u&&(!function(){const n=B();D(n),n.classList.add("spawn-and-shrug-bubble")}(),A(n.S,y(n.A.mn)))}),nt))}(n),function(n){n.sn>0&&(n.sn-=n.N/Zn,n.sn<0&&(n.sn=0))}(n)}async function ut(n){await async function(n){"suspended"!==n.S.state||n.wn||await n.S.resume()}(n),function(n){n.status===g.t&&dn(n)?(n.status=g.o,n.L=n.yn??n.k,Qn(n),N(n.mn)):n.status===g.u&&(n.status=g.t,n._=gn(),n.mn=0,n.J=(n.J+1)%Wn,n.pn=null,n.hn=null,et(n))}(n),pn(n),function(n){const t=n.k-n._.T;n.status===g.o&&t>u*rn&&(n._.j=!0)}(n)}function ct(n,t,e){const o=n.height,[u,c]=rt(t,e);n.width=u,n.height=c,function(n){n.cn.map((t=>{t.y=i(n)-U/2-xn/2}))}(n),function(n){n.P.map((t=>{t.y=Jn(n)}))}(n),function(n,t){const e=i({height:t}),o=n._.y,u=i(n);n._.y=u-(e-o)}(n,o),Y(n)}function rt(n,t){return[o,o*t/n]}function at(n){n.stopPropagation()}function st(n,t){const[e,i]=O(),u=Math.floor(e*window.devicePixelRatio),c=Math.floor(i*window.devicePixelRatio),r=u/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(u),n.height=Math.floor(c),n.getContext("2d").scale(r,r),t&&ct(t,n.width,n.height)}window.addEventListener("load",(async function(){const n=performance.now(),t=H(),e=document.querySelector(".info-button"),o=document.querySelector(".info-modal"),i=document.querySelector(".info-modal__card"),u=t.getContext("2d"),c=new AudioContext,{A:r,images:a}=await async function(n){const t={R:[],mn:[],H:[]},e=[E(n,"./sfx/die.mp3").then((n=>t.dn=n)),E(n,"./sfx/eat.wav").then((n=>t.Mn=n)),E(n,"./sfx/jump-0.mp3").then((n=>t.R[0]=n)),E(n,"./sfx/jump-1.mp3").then((n=>t.R[1]=n)),E(n,"./sfx/jump-2.mp3").then((n=>t.R[2]=n)),E(n,"./sfx/jump-3.mp3").then((n=>t.R[3]=n)),E(n,"./sfx/jump-4.mp3").then((n=>t.R[4]=n)),E(n,"./sfx/jump-5.mp3").then((n=>t.R[5]=n)),E(n,"./sfx/score-0.wav").then((n=>t.mn[0]=n)),E(n,"./sfx/score-1.wav").then((n=>t.mn[1]=n)),E(n,"./sfx/score-2.wav").then((n=>t.mn[2]=n)),E(n,"./sfx/score-3.wav").then((n=>t.mn[3]=n)),E(n,"./sfx/shoot-0.wav").then((n=>t.H[0]=n)),E(n,"./sfx/shoot-1.wav").then((n=>t.H[1]=n))],o={_:[],an:[],background:[]},i=[S("./img/player-0.png").then((n=>o._[0]=n)),S("./img/player-1.png").then((n=>o._[1]=n)),S("./img/player-2.png").then((n=>o._[2]=n)),S("./img/player-3.png").then((n=>o._[3]=n)),S("./img/player-4.png").then((n=>o._[4]=n)),S("./img/enemy-0.png").then((n=>o.an[0]=n)),S("./img/enemy-1.png").then((n=>o.an[1]=n)),S("./img/enemy-2.png").then((n=>o.an[2]=n)),S("./img/snack.png").then((n=>o.rn=n)),R("./img/background-0.png"),R("./img/background-1.png"),R("./img/background-2.png"),R("./img/background-3.png")];return await Promise.all([...e,...i]),{A:t,images:o}}(c),s=new URL(location),f="true"===s.searchParams.get("auto"),m="true"===s.searchParams.get("debug"),d="true"===s.searchParams.get("skip"),p="true"===s.searchParams.get("mute"),h="true"===s.searchParams.get("hungry"),w=s.searchParams.get("start"),y=s.searchParams.get("score"),M=s.searchParams.get("background"),b=w?Number.parseInt(w):void 0,v=y?Number.parseInt(y):0,x=M?Number.parseInt(M):1,T=localStorage.getItem(P)??0,[_,k]=O(),A=function(n,t,e,o,i,u,c,r,a,s,f,m,d,p){const[h,w]=rt(i,u);return{fn:r,un:a,wn:s,X:f,yn:m,en:n,S:t,A:e,images:o,width:h,height:w,W:0,U:0,k:0,N:0,nn:0,K:0,tn:0,$:0,Z:0,status:g.t,mn:d,ln:c,_:gn(),P:[],V:[],cn:[],D:[],B:[],L:0,gn:l(tt),bn:null,q:null,F:null,pn:null,hn:null,sn:0,J:p}}(u,c,r,a,_,k,T,f,m,p,h,b,v,x),j=performance.now()-n;setTimeout((()=>{!function(n,t,e,o,i,u){st(e),D(e),et(n),requestAnimationFrame((t=>{n.U=0,n.W=t,ot(n)})),window.addEventListener("resize",(()=>st(e,n)),{passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await ut(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(n)),document.addEventListener("keydown",function(n){return t=>{"Escape"===t.key&&C(n)}}(i),{passive:!0}),document.addEventListener("visibilitychange",function(n,t){return()=>{!function(n,t){document.hidden?n.suspend():t.wn||n.resume()}(n,t)}}(t,n)),e.addEventListener("pointerup",function(n,t){async function e(){await ut(t),n.addEventListener("pointerdown",o,{passive:!0})}async function o(){await ut(t)}return e}(e,n),{once:!0,passive:!0}),o.addEventListener("click",function(n){function t(){D(n)}return t}(i),{passive:!0}),i.addEventListener("click",function(n){function t(){C(n)}return t}(i),{passive:!0}),u.addEventListener("click",at,{passive:!0})}(A,c,t,e,o,i)}),d?0:Math.max(2e3-j,0))}))}();
