!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+68}const u=Object.freeze({t:"NOT_STARTED",o:"IN_PROGRESS",i:"GAME_OVER",u:"READY_FOR_RESET"});function c(n,t,e){e>0&&function o(i){n(i),i+1<e&&setTimeout((()=>o(i+1)),t)}(0)}function r(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function a(n){return Math.random()<n}function f(n,t){return Math.random()*(t-n)+n}function s(n,t,e,o,i=1/0){return function(n,t,e=1/0,o=()=>{}){for(let o=0;o<e;o++){const e=n();if(t(e))return e}return o()}((()=>function(n,t,e){return r(e,(()=>f(n,t)))}(n,t,e)),(n=>n.sort().every(((t,e)=>0===e||t-n[e-1]>=o))),i,(()=>null))}function m(){return a(.5)}function g(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function l(n){const t=f(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function p(n,t){return n[l(t)]}function d(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function h(n){return-n.width<n.x&&n.x<o}function w(n,t){return t/n}function y(n,t,e,o){return n+t*o+.5*e*o*o}function x(n,t,e){return n+t*e}function M(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}function v(n){return M(n).catch(console.error)}async function T(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function _(n,t,e=1,o=1){if("running"===n.state){const i=n.createBufferSource();i.buffer=t,i.playbackRate.value=e;const u=n.createGain();u.gain.value=o,i.connect(u),u.connect(n.destination),i.start()}}function S(n,t,e,o,i,u,c=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*u),n.scale(c,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-u,i,u),n.restore()}const R="high-score";function k(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function b(){F().forEach(I),P().forEach(j),X().forEach(j),j(N()),document.querySelector(".loading").classList.add("loading--completed")}function E(n){F().forEach(j),P().forEach(I),X().forEach(j),D().textContent=n}function A(n,t){F().forEach(j),P().forEach(j),X().forEach(I),j(C()),document.querySelector(".game__result-score").textContent=n,document.querySelector(".game__result-best").textContent=t}function O(n){const[t,e]=k(),o=[N(),C()],u=t/n.width,c=e/n.height;o.forEach((t=>{const o=n.width/2+24,r=i(n)-18;t.style.left=o*u+"px",t.style.bottom=e-r*c+"px"}))}function j(n){n.style.visibility="hidden"}function I(n){n.style.visibility="visible"}function F(){return[document.querySelector(".game__title"),document.querySelector(".info-button"),N()]}function P(){return[D()]}function X(){return[document.querySelector(".game__result"),C()]}function Y(){return document.querySelector(".game__canvas")}function D(){return document.querySelector(".game__score")}function N(){return document.querySelector(".game__start-hint")}function C(){return document.querySelector(".game__reset-hint")}const G=32,V=20,H=Math.floor(o/2)-G/2,L=-.75,q=L*L/224,z=2*Math.abs(L)/q,B=1.5625,J=2.5,U=.7,$=L,K=.35,Q=250,W=3e3,Z=180;function nn(){return{m:0,l:B,p:J,h:0,width:G,height:V,x:H,y:5*-V,velocityY:0,M:!0,v:0,isFrozen:!0}}function tn(n){return i(n)-V}function en(n){return n.T.y===tn(n)}function on(n){n.status!==u.o||n.T.M||(n.T.velocityY=L,n.T.m=1,n.T.M=!0,n.T.v=n._,_(n.S,g(n.k.R)))}function un(n){n.T.isFrozen||(n.status===u.t||n.status===u.o?(n.T.M&&(cn(n),rn(n),function(n){n.T.A&&!n.T.M&&(on(n),n.T.A=!1)}(n)),function(n){if(!n.T.M){const o=n.O.filter((n=>!n.j));if(o.length>0){const i=(t=o,e=n.T.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),u=n.T.l<0!==i.I;n.T.l*=u?-1:1}}var t,e}(n)):n.status===u.i&&(cn(n),rn(n)))}function cn(n){var t,e,o;n.T.velocityY=(t=n.T.velocityY,e=q,o=n.F,t+e*o),n.T.y=y(n.T.y,n.T.velocityY,q,n.F);n.T.velocityY/L<K&&(n.status===u.i?n.T.m=6:n.T.m=2)}function rn(n){(function(n){return n.T.y>tn(n)})(n)&&(n.T.y=tn(n),n.T.velocityY=0,n.T.M=!1,n.T.m=0,n.T.h=0,n.status===u.i&&(n.T.m=4))}function an(n){const t=f(Q,W);n.P=setTimeout((()=>{n.T.M||(n.T.m=3),n.P=setTimeout((()=>{n.T.M||(n.T.m=0),an(n)}),Z)}),t)}function fn(n){n.T.velocityY=$,n.T.m=5,function(n){clearTimeout(n.P)}(n)}const sn=10,mn=10,gn=H/.13,ln=2,pn=2,dn=.4,hn=sn*ln*.5,wn=[{m:0,velocityX:.13,X:.85},{m:1,velocityX:.18,X:.95},{m:2,velocityX:.24,X:1.1}],yn=[.4,.4,.2],xn=50,Mn=.8,vn=.25,Tn=.6,_n=60,Sn=60;function Rn(n){return i(n)-V/2-mn/2}function kn(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,u=i*i-4*o*-n;if(u<0)return null;{const n=Math.sqrt(u);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(Rn(n)-(tn(n)+V),L,q))}function bn(n){const t=n.Y.filter((t=>t.D<=n._));n.Y=n.Y.filter((t=>t.D>n._)),n.O.push(...t),c((()=>{!function(n,t){const e=g(n.k.N),o=Math.max(...t.map((n=>n.X))),i=f(-.05,.05),u=o+i;_(n.S,e,u,Tn)}(n,t)}),Sn,t.length)}function En(n){const t=function(n){function t(n,t){return n<(t?3:5)?[.1,.3,.6]:n<(t?9:24)?[.45,.4,.15]:n<(t?20:46)?[.65,.3,.05]:[.9,.1,0]}const e=[1*z,2.5*z,3.5*z],o=[2.5*z,3.5*z,7*z],i=t(n.C,n.G),u=l(i);return f(e[u],o[u])}(n);n.V=setTimeout((()=>{if(n.status!==u.o)return;const t=n._+gn;var e,i;const c=function(n){const t=m(),e=p(wn,yn).velocityX;return r(n,(()=>{const o=a(Math.pow(Mn,1/n))?t:!t,i=a(Math.pow(vn,1/n))?e:p(wn,yn).velocityX;return o?i:-i}))}((e=n.C,i=n.G,e<(i?2:5)?1+l([.9,.1]):e<(i?7:11)?1+l([.7,.2,.05,.05]):e<(i?16:29)?1+l([.5,.2,.1,.1]):1+l([.4,.2,.15,.15,.05,.05]))),f=c.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map);const g=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(new Map(c.map((e=>[e,An(n,t,e)]))),((n,[t,e])=>[n,function(n,t,e,o){const i=80;for(let u=e;u>0;u--){const e=s(n,t,u,o,i);if(e)return e}return[]}(t,e,f.get(n),sn*ln/Math.abs(n))])),d=Array.from(g,(([t,e])=>e.map((e=>function(n,t,e){const i=wn.find((n=>Math.abs(e)===n.velocityX)),u=e>=0,c=w(hn,e)*dn;return{D:t,m:i.m,l:ln,p:pn,h:0,H:c,width:sn,height:mn,x:u?-sn:o,y:Rn(n),velocityX:e,I:u,j:!1,X:i.X}}(n,e,t))))).flat();n.L.push(t),n.Y.push(...d),En(n)}),t)}function An(n,t,o){const i=xn+e,u=kn(n),c=t+z-u-i,r=H+G+sn;return[t+u+i-H/Math.abs(o),c-r/Math.abs(o)]}const On=10,jn=10,In=.095,Fn=.13,Pn=2.67,Xn=2.67,Yn=On*Pn*.5,Dn=.4,Nn=3,Cn=1,Gn=1500,Vn=18e3,Hn=500,Ln=6800,qn=60;function zn(n){return function(n,t){const e=i(n)-V/2-jn/2,u=n.G?Fn:In,c=w(Yn,u)*Dn;return{l:Pn,p:Xn,h:0,H:t?c:-c,width:On,height:jn,x:t?-On:o,y:e,velocityX:t?u:-u,I:t,j:!1}}(n,m())}function Bn(n){const t=n.G?f(Hn,Ln):f(Gn,Vn);n.q=setTimeout((()=>{if(n.status!==u.o)return;const t=zn(n);n.B.push(t),Bn(n)}),t)}const Jn=4,Un=400,$n=800;function Kn(n){var t;t=n.J,Y().style.backgroundImage=`url('../img/background-${t}.png')`,O(n),b(),an(n),setTimeout((()=>{n.T.isFrozen=!1}),1e3)}function Qn(i){for(let n=i.U;n>0;n-=e)i.F=Math.min(n,e),i._+=i.F,Wn(i),i.$+=1;i.K+=1,i.W-i.Z>=1e3&&(i.nn=i.K,i.tn=i.$,i.K=0,i.$=0,i.Z=i.W),function(e){(function(n){n.en.clearRect(0,0,o,n.height)})(e),function(n){S(n.en,n.images.T[n.T.m],n.T.x,n.T.y,n.T.width,n.T.height,n.T.l,n.T.p,n.T.h),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(n.T.x,n.T.y,G,V))}(e),function(n){for(const e of n.B)S(n.en,n.images.cn,e.x,e.y,e.width,e.height,e.l,e.p,e.h),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.O)S(n.en,n.images.rn[e.m],e.x,e.y,e.width,e.height,e.l,e.p,e.h),n.un&&(n.en.strokeStyle=t,n.en.strokeRect(e.x,e.y,sn,mn))}(e),function(n){n.an>0&&(n.en.fillStyle=`rgba(255, 255, 255, ${n.an})`,n.en.fillRect(0,0,o,n.height))}(e),function(e){if(e.un){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.nn)+" F/S",Math.round(e.tn)+" U/S"].filter(Boolean).join("   ");e.en.font=n,e.en.fillStyle=t,e.en.fillText(i,8,e.height-8),e.en.strokeStyle=t,e.en.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.U=n-i.W,i.W=n,Qn(i)}))}function Wn(n){!function(n){const t=n.L.length>0&&n.L[0]<=n._;n.fn&&t&&(on(n),n.L.shift())}(n),un(n),bn(n),function(n){for(const t of n.O)t.x=y(t.x,t.velocityX,0,n.F),t.h=x(t.h,t.H,n.F)}(n),function(n){for(const t of n.B)t.x=y(t.x,t.velocityX,0,n.F),t.h=x(t.h,t.H,n.F)}(n),function(n){if(n.G)return;if(n.status!==u.o)return;const t=n.C,e=n.O.filter((n=>{const t=!n.j,e=n.I&&n.x>H+G,o=!n.I&&n.x+sn<H;return t&&(e||o)}));e.forEach((n=>n.j=!0)),n.C+=e.length,c((e=>{n.status===u.o&&(_(n.S,g(n.k.C)),E(t+e+1))}),_n,e.length)}(n),function(n){if(n.status!==u.o)return;const t=n.C,e=n.G?Cn:Nn,o=n.B.filter((t=>{const e=!t.j,o=d(n.T,t);return e&&o}));o.forEach((n=>n.j=!0)),n.B=n.B.filter((n=>!o.includes(n))),n.C+=o.length*e,c((e=>{n.status===u.o&&(_(n.S,g(n.k.C)),E(t+e+1))}),qn,o.length*e)}(n),function(n){n.status===u.o?function(n){for(const t of n.O)if(d(n.T,t))return!0;return!1}(n)&&(!function(n){n.C>n.sn&&(n.sn=n.C,t=n.C,localStorage.setItem(R,t));var t}(n),function(n){clearTimeout(n.q)}(n),function(n){clearTimeout(n.V)}(n),function(n){n.an=1}(n),fn(n),n.status=u.i,_(n.S,n.k.mn)):n.status===u.i&&function(n){return 0===n.O.length&&0===n.B.length}(n)&&(n.status=u.u,A(n.C,n.sn))}(n),function(n){n.O=n.O.filter(h)}(n),function(n){n.B=n.B.filter(h)}(n),function(n){n.status===u.t&&en(n)&&!n.gn?n.gn=setTimeout((()=>{n.status===u.t&&(I(N()),_(n.S,g(n.k.C)))}),$n):n.status!==u.u||n.ln||(n.ln=setTimeout((()=>{n.status===u.u&&(I(C()),_(n.S,g(n.k.C)))}),$n))}(n),function(n){n.an>0&&(n.an-=n.F/Un,n.an<0&&(n.an=0))}(n)}async function Zn(n){await async function(n){"suspended"===n.S.state&&await n.S.resume()}(n),function(n){n.status===u.t&&en(n)?(n.status=u.o,Bn(n),En(n),E(n.C)):n.status===u.u&&(n.status=u.t,n.T=nn(),n.C=0,n.J=(n.J+1)%Jn,n.gn=null,n.ln=null,Kn(n))}(n),on(n),function(n){const t=n._-n.T.v;n.status===u.o&&t>z*U&&(n.T.A=!0)}(n)}function nt(n,t,e){const o=n.height,[u,c]=tt(t,e);n.width=u,n.height=c,function(n){n.B.map((t=>{t.y=i(n)-V/2-jn/2}))}(n),function(n){n.O.map((t=>{t.y=Rn(n)}))}(n),function(n,t){const e=i({height:t}),o=n.T.y,u=i(n);n.T.y=u-(e-o)}(n,o),O(n)}function tt(n,t){return[o,o*t/n]}function et(n){n.stopPropagation()}function ot(n,t){const[e,i]=k(),u=Math.floor(e*window.devicePixelRatio),c=Math.floor(i*window.devicePixelRatio),r=u/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(u),n.height=Math.floor(c),n.getContext("2d").scale(r,r),t&&nt(t,n.width,n.height)}window.addEventListener("load",(async function(){const n=performance.now(),t=Y(),e=document.querySelector(".info-button"),o=document.querySelector(".info-modal"),i=document.querySelector(".info-modal__card"),c=t.getContext("2d"),r=new AudioContext,{k:a,images:f}=await async function(n){const t={R:[],C:[],N:[]},e=[T(n,"./sfx/die.mp3").then((n=>t.mn=n)),T(n,"./sfx/eat.wav").then((n=>t.pn=n)),T(n,"./sfx/jump-0.mp3").then((n=>t.R[0]=n)),T(n,"./sfx/jump-1.mp3").then((n=>t.R[1]=n)),T(n,"./sfx/jump-2.mp3").then((n=>t.R[2]=n)),T(n,"./sfx/jump-3.mp3").then((n=>t.R[3]=n)),T(n,"./sfx/jump-4.mp3").then((n=>t.R[4]=n)),T(n,"./sfx/jump-5.mp3").then((n=>t.R[5]=n)),T(n,"./sfx/score-0.wav").then((n=>t.C[0]=n)),T(n,"./sfx/score-1.wav").then((n=>t.C[1]=n)),T(n,"./sfx/score-2.wav").then((n=>t.C[2]=n)),T(n,"./sfx/score-3.wav").then((n=>t.C[3]=n)),T(n,"./sfx/shoot-0.wav").then((n=>t.N[0]=n)),T(n,"./sfx/shoot-1.wav").then((n=>t.N[1]=n))],o={T:[],rn:[],background:[]},i=[M("./img/player-0.png").then((n=>o.T[0]=n)),M("./img/player-1.png").then((n=>o.T[1]=n)),M("./img/player-2.png").then((n=>o.T[2]=n)),M("./img/player-3.png").then((n=>o.T[3]=n)),M("./img/player-4.png").then((n=>o.T[4]=n)),M("./img/player-5.png").then((n=>o.T[5]=n)),M("./img/player-6.png").then((n=>o.T[6]=n)),M("./img/enemy-0.png").then((n=>o.rn[0]=n)),M("./img/enemy-1.png").then((n=>o.rn[1]=n)),M("./img/enemy-2.png").then((n=>o.rn[2]=n)),M("./img/snack.png").then((n=>o.cn=n)),v("./img/background-0.png"),v("./img/background-1.png"),v("./img/background-2.png"),v("./img/background-3.png")];return await Promise.all([...e,...i]),{k:t,images:o}}(r),s=new URL(location),m="true"===s.searchParams.get("auto"),g="true"===s.searchParams.get("debug"),l="true"===s.searchParams.get("skip"),p="true"===s.searchParams.get("hungry"),d=Number.parseInt(s.searchParams.get("score"))||0,h=localStorage.getItem(R)??0,[w,y]=k(),x=function(n,t,e,o,i,c,r,a,f,s,m){const[g,l]=tt(i,c);return{fn:a,un:f,G:s,en:n,S:t,k:e,images:o,width:g,height:l,W:0,U:0,_:0,F:0,nn:0,K:0,tn:0,$:0,Z:0,status:u.t,C:m,sn:r,T:nn(),O:[],Y:[],B:[],L:[],q:null,V:null,P:null,gn:null,ln:null,an:0,J:1}}(c,r,a,f,w,y,h,m,g,p,d),_=performance.now()-n;setTimeout((()=>{!function(n,t,e,o,i,u){ot(e),I(e),Kn(n),requestAnimationFrame((t=>{n.U=0,n.W=t,Qn(n)})),window.addEventListener("resize",(()=>ot(e,n)),{passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await Zn(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(n)),document.addEventListener("keydown",function(n){return t=>{"Escape"===t.key&&j(n)}}(i),{passive:!0}),document.addEventListener("visibilitychange",function(n){return()=>{!function(n){document.hidden?n.suspend():n.resume()}(n)}}(t)),e.addEventListener("pointerup",function(n,t){async function e(){await Zn(t),n.addEventListener("pointerdown",o,{passive:!0})}async function o(){await Zn(t)}return e}(e,n),{once:!0,passive:!0}),o.addEventListener("click",function(n){function t(){I(n)}return t}(i),{passive:!0}),i.addEventListener("click",function(n){function t(){j(n)}return t}(i),{passive:!0}),u.addEventListener("click",et,{passive:!0})}(x,r,t,e,o,i)}),l?0:Math.max(2e3-_,0))}))}();
