!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+69}function u(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function c(n){return Math.random()<n}function r(n,t){return Math.random()*(t-n)+n}function a(n,t,e,o,i=1/0){return function(n,t,e=1/0,o=()=>{}){for(let o=0;o<e;o++){const e=n();if(t(e))return e}return o()}((()=>function(n,t,e){return u(e,(()=>r(n,t)))}(n,t,e)),(n=>n.sort().every(((t,e)=>0===e||t-n[e-1]>=o))),i,(()=>null))}function f(){return c(.5)}function s(n){return n[(t=0,e=n.length,Math.floor(Math.random()*(e-t))+t)];var t,e}function m(n){const t=r(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function p(n,t){return n[m(t)]}function g(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function l(n){return-n.width<n.x&&n.x<o}function d(n,t){return t/n}function h(n,t,e,o){return n+t*o+.5*e*o*o}function w(n,t,e){return n+t*e}function y(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}async function M(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function x(n,t,e=1){if("running"===n.state){const o=n.createBufferSource();o.buffer=t,o.playbackRate.value=e,o.connect(n.destination),o.start()}}function v(n,t,e,o,i,u,c=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*u),n.scale(c,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-u,i,u),n.restore()}const T="high-score";function S(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function R(){E().forEach(I),k().forEach(X),j().forEach(X)}function A(n){E().forEach(X),k().forEach(I),j().forEach(X),document.querySelector(".game-score").textContent=n}function E(){return[document.querySelector(".home-title"),document.querySelector(".home-hint")]}function k(){return[document.querySelector(".game-score")]}function j(){return[document.querySelector(".game-over-result"),document.querySelector(".game-over-hint")]}function X(n){n.style.visibility="hidden"}function I(n){n.style.visibility="visible"}const b=20,_=20,F=Math.floor(o/2)-b/2,G=-.75,C=G*G/224,L=2*Math.abs(G)/C,O=2.5,Y=2.5,B=.7,N=G,P=.35,V=250,q=3e3,D=180;function J(){return{t:0,o:O,i:Y,u:0,width:b,height:_,x:F,y:3.5*-_,velocityY:0,m:!0,p:0}}function U(n){return i(n)-_}function z(n){n.status!==kn||n.l.m||(n.l.velocityY=G,n.l.t=1,n.l.m=!0,n.l.p=n.h,x(n.M,s(n.T.v)))}function $(n){n.status===En||n.status===kn?(n.l.m&&(H(n),K(n),function(n){n.l.S&&!n.l.m&&(z(n),n.l.S=!1)}(n)),function(n){if(!n.l.m){const o=n.R.filter((n=>!n.A));if(o.length>0){const i=(t=o,e=n.l.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),u=n.l.o<0!==i.k;n.l.o*=u?-1:1}}var t,e}(n)):n.status===jn&&(H(n),K(n))}function H(n){var t,e,o;n.l.velocityY=(t=n.l.velocityY,e=C,o=n.j,t+e*o),n.l.y=h(n.l.y,n.l.velocityY,C,n.j);n.l.velocityY/G<P&&(n.status===jn?n.l.t=6:n.l.t=2)}function K(n){(function(n){return n.l.y>U(n)})(n)&&(n.l.y=U(n),n.l.velocityY=0,n.l.m=!1,n.l.t=0,n.l.u=0,n.status===jn&&(n.l.t=4))}function Q(n){const t=r(V,q);n.X=setTimeout((()=>{n.l.m||(n.l.t=3),n.X=setTimeout((()=>{n.l.m||(n.l.t=0),Q(n)}),D)}),t)}function W(n){n.l.velocityY=N,n.l.t=5,function(n){clearTimeout(n.X)}(n)}const Z=10,nn=10,tn=2,en=2,on=.4,un=Z*tn*.5,cn=[{t:0,velocityX:.13,I:.7},{t:1,velocityX:.17,I:1},{t:2,velocityX:.22,I:1.4}],rn=[.4,.4,.2],an=F/.13,fn=50,sn=.8,mn=.25;function pn(n){return i(n)-_/2-nn/2}function gn(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,u=i*i-4*o*-n;if(u<0)return null;{const n=Math.sqrt(u);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(pn(n)-(U(n)+_),G,C))}function ln(n){const t=function(n){function t(n){return n<5?[.1,.3,.6]:n<24?[.45,.4,.15]:n<46?[.65,.3,.05]:[.9,.1,0]}const e=[1*L,2.5*L,3.5*L],o=[2.5*L,3.5*L,7*L],i=m(t(n));return r(e[i],o[i])}(n._);n.F=setTimeout((()=>{if(n.status!==kn)return;const t=n.h+an;var e;const i=function(n){const t=f(),e=p(cn,rn).velocityX;return u(n,(()=>{const o=c(Math.pow(sn,1/n))?t:!t,i=c(Math.pow(mn,1/n))?e:p(cn,rn).velocityX;return o?i:-i}))}((e=n._)<5?1+m([.9,.1]):e<11?1+m([.7,.2,.05,.05]):e<29?1+m([.5,.2,.1,.1]):1+m([.4,.2,.15,.15,.05,.05])),r=i.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map);const s=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(new Map(i.map((e=>[e,dn(n,t,e)]))),((n,[t,e])=>[n,function(n,t,e,o){const i=10;for(let u=0;u<e;u++){const c=a(n,t,e-u,o,i);if(c)return c}}(t,e,r.get(n),Z*tn/Math.abs(n))])),g=Array.from(s,(([t,e])=>e.map((e=>function(n,t,e){const i=cn.find((n=>Math.abs(e)===n.velocityX)).t,u=cn.find((n=>Math.abs(e)===n.velocityX)).I,c=e>=0,r=d(un,e)*on;return{G:t,t:i,o:tn,i:en,u:0,C:r,width:Z,height:nn,x:c?-Z:o,y:pn(n),velocityX:e,k:c,A:!1,I:u}}(n,e,t))))).flat();n.L.push(t),n.O.push(...g),ln(n)}),t)}function dn(n,t,o){const i=fn+e,u=gn(n),c=t+L-u-i,r=F+b+Z;return[t+u+i-F/Math.abs(o),c-r/Math.abs(o)]}const hn=10,wn=10,yn=.095,Mn=2.67,xn=2.67,vn=.4*d(hn*Mn*.5,yn),Tn=2e3,Sn=25e3;function Rn(n){return function(n,t){return{o:Mn,i:xn,u:0,C:t?vn:-vn,width:hn,height:wn,x:t?-hn:o,y:n,velocityX:t?yn:-yn,k:t,A:!1}}(n,f())}function An(n){const t=r(Tn,Sn);n.Y=setTimeout((()=>{if(n.status!==kn)return;const t=Rn(i(n)-_/2-wn/2);n.B.push(t),An(n)}),t)}const En="GAME_NOT_STARTED",kn="GAME_IN_PROGRESS",jn="GAME_OVER",Xn="GAME_RESETTABLE",In=400;function bn(i){for(let n=i.N;n>0;n-=e)i.j=Math.min(n,e),i.h+=i.j,_n(i),i.P+=1;i.V+=1,i.q-i.D>=1e3&&(i.J=i.V,i.U=i.P,i.V=0,i.P=0,i.D=i.q),function(e){(function(n){n.$.clearRect(0,0,o,n.height)})(e),function(n){v(n.$,n.images.l[n.l.t],n.l.x,n.l.y,n.l.width,n.l.height,n.l.o,n.l.i,n.l.u),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(n.l.x,n.l.y,b,_))}(e),function(n){for(const e of n.B)v(n.$,n.images.K,e.x,e.y,e.width,e.height,e.o,e.i,e.u),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.R)v(n.$,n.images.W[e.t],e.x,e.y,e.width,e.height,e.o,e.i,e.u),n.H&&(n.$.strokeStyle=t,n.$.strokeRect(e.x,e.y,Z,nn))}(e),function(n){n.Z>0&&(n.$.fillStyle=`rgba(255, 255, 255, ${n.Z})`,n.$.fillRect(0,0,o,n.height))}(e),function(e){if(e.H){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.J)+" F/S",Math.round(e.U)+" U/S"].filter(Boolean).join("   ");e.$.font=n,e.$.fillStyle=t,e.$.fillText(i,8,e.height-8),e.$.strokeStyle=t,e.$.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.N=n-i.q,i.q=n,bn(i)}))}function _n(n){!function(n){const t=n.L.length>0&&n.L[0]<=n.h;n.nn&&t&&(z(n),n.L.shift())}(n),$(n),function(n){const t=n.O.filter((t=>t.G<=n.h));n.O=n.O.filter((t=>t.G>n.h)),n.R.push(...t),t.length>0&&x(n.M,n.T.tn,t[0].I)}(n),function(n){for(const t of n.R)t.x=h(t.x,t.velocityX,0,n.j),t.u=w(t.u,t.C,n.j)}(n),function(n){for(const t of n.B)t.x=h(t.x,t.velocityX,0,n.j),t.u=w(t.u,t.C,n.j)}(n),function(n){if(n.status!==kn)return;const t=n.R.filter((n=>{const t=!n.A,e=n.k&&n.x>F+b,o=!n.k&&n.x+Z<F;return t&&(e||o)}));t.forEach((n=>n.A=!0)),n._+=t.length,t.length>0&&(x(n.M,s(n.T._)),A(n._))}(n),function(n){if(n.status!==kn)return;const t=n.B.filter((t=>{const e=!t.A,o=g(n.l,t);return e&&o}));t.forEach((n=>n.A=!0)),n._+=t.length,n.B=n.B.filter((n=>!t.includes(n))),t.length>0&&(x(n.M,n.T.en),A(n._))}(n),function(n){n.status===kn?function(n){for(const t of n.R)if(g(n.l,t))return!0;return!1}(n)&&(!function(n){n._>n.un&&(n.un=n._,t=n._,localStorage.setItem(T,t));var t}(n),function(n){clearTimeout(n.Y)}(n),function(n){clearTimeout(n.F)}(n),function(n){n.Z=1}(n),W(n),n.status=jn,x(n.M,n.T.cn)):n.status===jn&&function(n){return 0===n.R.length&&0===n.B.length}(n)&&(n.status=Xn,t=n._,e=n.un,E().forEach(X),k().forEach(X),j().forEach(I),document.querySelector(".game-over-score").textContent=t,document.querySelector(".game-over-high-score").textContent=e);var t,e}(n),function(n){n.R=n.R.filter(l)}(n),function(n){n.B=n.B.filter(l)}(n),function(n){n.Z>0&&(n.Z-=n.j/In,n.Z<0&&(n.Z=0))}(n)}async function Fn(n){await async function(n){"suspended"===n.M.state&&await n.M.resume()}(n),function(n){n.status===En&&function(n){return n.l.y===U(n)}(n)?(n.status=kn,An(n),ln(n),A(n._)):n.status===Xn&&(n.status=En,n.l=J(),n._=0,Q(n),R())}(n),z(n),function(n){const t=n.h-n.l.p;n.status===kn&&t>L*B&&(n.l.S=!0)}(n)}function Gn(n,t,e){const o=n.height,[u,c]=Cn(t,e);n.width=u,n.height=c,function(n){n.B.map((t=>{t.y=i(n)-_/2-wn/2}))}(n),function(n){n.R.map((t=>{t.y=pn(n)}))}(n),function(n,t){const e=i({height:t}),o=n.l.y,u=i(n);n.l.y=u-(e-o)}(n,o)}function Cn(n,t){return[o,o*t/n]}function Ln(n,t){const[e,i]=S(),u=Math.floor(e*window.devicePixelRatio),c=Math.floor(i*window.devicePixelRatio),r=u/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(u),n.height=Math.floor(c),n.getContext("2d").scale(r,r),t&&Gn(t,n.width,n.height)}window.addEventListener("load",(async function(){const n=document.querySelector(".canvas"),t=n.getContext("2d"),e=new AudioContext,o={v:[],_:[]},i=[M(e,"./sfx/die.mp3").then((n=>o.cn=n)),M(e,"./sfx/eat.wav").then((n=>o.en=n)),M(e,"./sfx/jump-0.mp3").then((n=>o.v[0]=n)),M(e,"./sfx/jump-1.mp3").then((n=>o.v[1]=n)),M(e,"./sfx/jump-2.mp3").then((n=>o.v[2]=n)),M(e,"./sfx/jump-3.mp3").then((n=>o.v[3]=n)),M(e,"./sfx/jump-4.mp3").then((n=>o.v[4]=n)),M(e,"./sfx/jump-5.mp3").then((n=>o.v[5]=n)),M(e,"./sfx/score-0.wav").then((n=>o._[0]=n)),M(e,"./sfx/score-1.wav").then((n=>o._[1]=n)),M(e,"./sfx/score-2.wav").then((n=>o._[2]=n)),M(e,"./sfx/score-3.wav").then((n=>o._[3]=n)),M(e,"./sfx/shoot.wav").then((n=>o.tn=n))],u={l:[],W:[]},c=[y("./img/player-0.png").then((n=>u.l[0]=n)),y("./img/player-1.png").then((n=>u.l[1]=n)),y("./img/player-2.png").then((n=>u.l[2]=n)),y("./img/player-3.png").then((n=>u.l[3]=n)),y("./img/player-4.png").then((n=>u.l[4]=n)),y("./img/player-5.png").then((n=>u.l[5]=n)),y("./img/player-6.png").then((n=>u.l[6]=n)),y("./img/enemy-0.png").then((n=>u.W[0]=n)),y("./img/enemy-1.png").then((n=>u.W[1]=n)),y("./img/enemy-2.png").then((n=>u.W[2]=n)),y("./img/snack.png").then((n=>u.K=n))];await Promise.all([...i,...c]);const r=new URL(location),a="true"===r.searchParams.get("auto"),f="true"===r.searchParams.get("debug"),s=Number.parseInt(r.searchParams.get("score"))||0,m=localStorage.getItem(T)??0,[p,g]=S(),l=function(n,t,e,o,i,u,c,r,a,f){const[s,m]=Cn(i,u);return{$:n,M:t,T:e,images:o,width:s,height:m,q:0,N:0,h:0,j:0,status:En,_:f,un:c,l:J(),R:[],O:[],B:[],L:[],nn:r,H:a,J:0,V:0,U:0,P:0,D:0,Y:null,F:null,X:null,Z:0}}(t,e,o,u,p,g,m,a,f,s);Ln(n),I(n),R(),requestAnimationFrame((n=>{l.N=0,l.q=n,Q(l),bn(l)})),window.addEventListener("resize",(()=>Ln(n,l)),{passive:!0}),document.addEventListener("pointerup",function(n){async function t(){await Fn(n),document.addEventListener("pointerdown",e,{passive:!0})}async function e(){await Fn(n)}return t}(l),{once:!0,passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await Fn(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(l))}))}();
