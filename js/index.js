!function(){"use strict";const n="9px sans-serif",t="#0f0",e=1e3/29,o=360;function i(n){return n.height/2+68}const u=.125,c=.095,r=u,a=Math.min(u,.18,.235,c,r),s=Object.freeze({t:"NOT_STARTED",o:"IN_PROGRESS",i:"GAME_OVER",u:"READY_FOR_RESET"});function f(n,t=1/0){const e=[];let o=!1;function i(){if(o||0===e.length)return;o=!0;const{m:t,resolve:u,reject:c}=e.shift();Promise.resolve().then((()=>t())).then(u).catch(c).finally((()=>{setTimeout((()=>{o=!1,i()}),n)}))}return function(n){return e.length>=t?Promise.reject(Error("Queue size limit reached")):new Promise(((t,o)=>{e.push({m:n,resolve:t,reject:o}),i()}))}}function m(n,t=n=>{}){return Array.from({length:n},((n,e)=>t(e)))}function g(n){return Math.random()<n}function l(n,t){return Math.floor(Math.random()*(t-n))+n}function d(n,t){return Math.random()*(t-n)+n}function p(){return g(.5)}function h(n){return n[l(0,n.length)]}function w(n){const t=d(0,n.reduce(((n,t)=>n+t),0));let e=0;for(let o=0;o<n.length;o++)if(e+=n[o],t<e)return o}function y(n,t){return n[w(t)]}function x(n,t){return n.x<t.x+t.width&&n.y<t.y+t.height&&t.x<n.x+n.width&&t.y<n.y+n.height}function M(n){return-n.width<n.x&&n.x<o}function b(n,t){return t/n}function v(n,t,e,o){return n+t*o+.5*e*o*o}function _(n,t,e){return n+t*e}function T(n){return new Promise(((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=n=>e(n),o.src=n}))}function S(n){return T(n).catch(console.error)}async function k(n,t){const e=await fetch(t),o=await e.arrayBuffer();return await n.decodeAudioData(o)}function R(n,t,e=1,o=1){if("running"===n.state){const i=n.createBufferSource();i.buffer=t,i.playbackRate.value=e;const u=n.createGain();u.gain.value=o,i.connect(u),u.connect(n.destination),i.start()}}function E(n,t,e,o,i,u,c=1,r=1,a=0){n.save(),n.translate(e+.5*i,o+.5*u),n.scale(c,r),n.rotate(a),n.drawImage(t,.5*-i,.5*-u,i,u),n.restore()}const A="high-score";function P(){const n=window.matchMedia("(min-aspect-ratio: 1/1) and (min-width: 900px)").matches?64:0;return[Math.min(window.innerWidth,window.innerHeight)-2*n,window.innerHeight-2*n]}function j(){D().forEach(Y),C().forEach(N),G().forEach(N),function(){const n=H();N(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".loading").classList.add("loading--completed")}function O(n){D().forEach(N),C().forEach(Y),G().forEach(N),z().textContent=n}function I(n,t){D().forEach(N),C().forEach(N),G().forEach(Y),function(){const n=L();N(n),n.classList.remove("spawn-and-shrug-bubble")}(),document.querySelector(".game__result-score").textContent=n,document.querySelector(".game__result-best").textContent=t}function F(n){const t=document.querySelector(".game__canvas-container");t.classList.add("game__canvas-container--bg-"+n),setTimeout((()=>{t.classList.remove(...[0,1,2,3].map((n=>"game__canvas-container--bg-"+n))),V().style.backgroundImage=`url('../img/background-${n}.png')`}),2e3)}function X(n){const[t,e]=P(),o=[H(),L()],u=t/n.width,c=e/n.height;o.forEach((t=>{const o=n.width/2+24,r=i(n)-18;t.style.left=o*u+"px",t.style.bottom=e-r*c+"px"}))}function N(n){n.style.visibility="hidden"}function Y(n){n.style.visibility="visible"}function D(){return[document.querySelector(".game__title"),document.querySelector(".info-button"),H()]}function C(){return[z()]}function G(){return[document.querySelector(".game__result"),L()]}function V(){return document.querySelector(".game__canvas")}function z(){return document.querySelector(".game__score")}function H(){return document.querySelector(".game__start-hint")}function L(){return document.querySelector(".game__reset-hint")}const q=32,B=20,J=Math.floor(o/2)-q/2,U=600,$=8*(o/3)/(U*U),Q=-U*$/2,K=1.5625,W=2.5,Z=.7,nn=Q,tn=.35,en=250,on=3e3,un=180;function cn(){return{l:0,p:K,h:W,M:0,width:q,height:B,x:J,y:5*-B,velocityY:0,v:!0,_:0,isFrozen:!0}}function rn(n){return i(n)-B}function an(n){return n.T.y===rn(n)}function sn(n){n.status!==s.o||n.T.v||(n.T.velocityY=Q,n.T.l=1,n.T.v=!0,n.T._=n.S,R(n.k,h(n.A.R)))}function fn(n){n.T.isFrozen||(n.status===s.t||n.status===s.o?(n.T.v&&(mn(n),gn(n),function(n){n.T.P&&!n.T.v&&(sn(n),n.T.P=!1)}(n)),function(n){if(!n.T.v){const o=n.j.filter((n=>!n.O));if(o.length>0){const i=(t=o,e=n.T.x,function(n,t=n=>n){return n.reduce(((n,e)=>t(e)<t(n)?e:n))}(t,(n=>Math.abs(n.x-e)))),u=n.T.p<0!==i.I;n.T.p*=u?-1:1}}var t,e}(n)):n.status===s.i&&(mn(n),gn(n)))}function mn(n){var t,e,o;n.T.velocityY=(t=n.T.velocityY,e=$,o=n.F,t+e*o),n.T.y=v(n.T.y,n.T.velocityY,$,n.F);n.T.velocityY/Q<tn&&(n.status===s.i?n.T.l=6:n.T.l=2)}function gn(n){(function(n){return n.T.y>rn(n)})(n)&&(n.T.y=rn(n),n.T.velocityY=0,n.T.v=!1,n.T.l=0,n.T.M=0,n.status===s.i&&(n.T.l=4))}function ln(n){const t=d(en,on);n.X=setTimeout((()=>{n.T.v||(n.T.l=3),n.X=setTimeout((()=>{n.T.v||(n.T.l=0),ln(n)}),un)}),t)}function dn(n){n.T.velocityY=nn,n.T.l=5,function(n){clearTimeout(n.X)}(n)}const pn=10,hn=10,wn=2.67,yn=2.67,xn=pn*wn*.5,Mn=.4,bn=3,vn=1,_n=.2,Tn=.7;function Sn(n){return function(n,t){const e=i(n)-B/2-hn/2,u=n.N?r:c,a=b(xn,u)*Mn;return{p:wn,h:yn,M:0,Y:t?a:-a,width:pn,height:hn,x:t?-pn:o,y:e,velocityX:t?u:-u,I:t,O:!1}}(n,p())}const kn=10,Rn=10,En=J/a,An=2,Pn=2,jn=.4,On=kn*An*.5,In=[{l:0,velocityX:u,D:.85},{l:1,velocityX:.18,D:.95},{l:2,velocityX:.235,D:1.1}],Fn=[.4,.4,.2],Xn=50,Nn=.8,Yn=.25,Dn=.6,Cn=60;function Gn(n){return i(n)-B/2-Rn/2}function Vn(n){return Math.min(...function(n,t,e){const o=.5*e,i=t,u=i*i-4*o*-n;if(u<0)return null;{const n=Math.sqrt(u);return[(-i+n)/(2*o),(-i-n)/(2*o)]}}(Gn(n)-(rn(n)+B),Q,$))}function zn(n){const t=n.C.filter((t=>t.G<=n.S));var e,o,i;n.C=n.C.filter((t=>t.G>n.S)),n.j.push(...t),e=()=>{!function(n,t){const e=h(n.A.V),o=Math.max(...t.map((n=>n.D))),i=d(-.05,.05),u=o+i;R(n.k,e,u,Dn)}(n,t)},o=Cn,(i=t.length)>0&&function n(t){e(t),t+1<i&&setTimeout((()=>n(t+1)),o)}(0)}function Hn(n){const t=function(n){function t(n){return n<1e4?[.1,.3,.6]:n<25e3?[.45,.4,.15]:n<4e4?[.65,.3,.05]:[.9,.1,0]}const e=[1*U,2.5*U,3.5*U],o=[2.5*U,3.5*U,7*U],i=w(t(n));return d(e[i],o[i])}(n.S-n.H);n.L=setTimeout((()=>{if(n.status!==s.o)return;const t=n.S+En;!function(n,t){const e=(f=n.S-n.H,f<1e4?1+w([.9,.1]):f<15e3?1+w([.7,.2,.05,.05]):f<3e4?1+w([.5,.2,.1,.1]):1+w([.4,.2,.15,.15,.05,.05])),i=function(n){const t=p(),e=y(In,Fn).velocityX;return m(n,(()=>{const o=g(Math.pow(Nn,1/n))?t:!t,i=g(Math.pow(Yn,1/n))?e:y(In,Fn).velocityX;return o?i:-i}))}(e),u=(s=i,s.reduce(((n,t)=>{const e=n.get(t)??0;return n.set(t,e+1),n}),new Map)),c=new Map(i.map((e=>[e,Ln(n,t,e)]))),r=function(n,t=(n,t)=>[n,t]){return new Map(Array.from(n,(([n,e])=>t(n,e))))}(c,((n,[t,e])=>[n,function(n,t,e,o){const i=Math.floor((t-n)/o)+1,u=Math.min(e,i),c=function(n){const t=n.slice();for(let n=t.length-1;n>=0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t}(m(i,(n=>n))).slice(0,u).sort(((n,t)=>n-t));if(0===c.length)return[];const r=c[0],a=c[c.length-1],s=d(0,t-n-(a-r)*o);return c.map((t=>n+(t-r)*o+s))}(t,e,u.get(n),(kn*An+2)/Math.abs(n))])),a=Array.from(r,(([t,e])=>e.map((e=>function(n,t,e){const i=In.find((n=>Math.abs(e)===n.velocityX)),u=e>=0,c=b(On,e)*jn;return{G:t,l:i.l,p:An,h:Pn,M:0,Y:c,width:kn,height:Rn,x:u?-kn:o,y:Gn(n),velocityX:e,I:u,O:!1,D:i.D}}(n,e,t))))).flat();var s;var f;n.q.push(t),n.C.push(...a)}(n,t),function(n,t){if(n.status!==s.o)return;if(!g(n.N?Tn:_n))return;const e=Sn(n),o=n.N?r:c,i=t-J/o,u=l(-U,2*U);e.G=i+u;const a=(pn*wn+4)/Math.abs(o);[...n.B,...n.J].some((n=>Math.abs(e.G-n.G)<a))||n.J.push(e)}(n,t),Hn(n)}),t)}function Ln(n,t,o){const i=Xn+e,u=Vn(n),c=t+U-u-i,r=J+q+kn;return[t+u+i-J/Math.abs(o),c-r/Math.abs(o)]}const qn=4,Bn=400,Jn=800,Un=60;function $n(n){F(n.U),X(n),j(),ln(n),setTimeout((()=>{n.T.isFrozen=!1}),2e3)}function Qn(i){for(let n=i.$;n>0;n-=e)i.F=Math.min(n,e),i.S+=i.F,Kn(i),i.K+=1;i.W+=1,i.Z-i.nn>=1e3&&(i.tn=i.W,i.en=i.K,i.W=0,i.K=0,i.nn=i.Z),function(e){(function(n){n.un.clearRect(0,0,o,n.height)})(e),function(n){E(n.un,n.images.T[n.T.l],n.T.x,n.T.y,n.T.width,n.T.height,n.T.p,n.T.h,n.T.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(n.T.x,n.T.y,q,B))}(e),function(n){for(const e of n.B)E(n.un,n.images.rn,e.x,e.y,e.width,e.height,e.p,e.h,e.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(e.x,e.y,e.width,e.height))}(e),function(n){for(const e of n.j)E(n.un,n.images.an[e.l],e.x,e.y,e.width,e.height,e.p,e.h,e.M),n.cn&&(n.un.strokeStyle=t,n.un.strokeRect(e.x,e.y,kn,Rn))}(e),function(n){n.sn>0&&(n.un.fillStyle=`rgba(255, 255, 255, ${n.sn})`,n.un.fillRect(0,0,o,n.height))}(e),function(e){if(e.cn){const i=[performance.memory&&(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)+" MB",Math.round(e.tn)+" F/S",Math.round(e.en)+" U/S"].filter(Boolean).join("   ");e.un.font=n,e.un.fillStyle=t,e.un.fillText(i,8,e.height-8),e.un.strokeStyle=t,e.un.strokeRect(0,0,o,e.height)}}(e)}(i),requestAnimationFrame((n=>{i.$=n-i.Z,i.Z=n,Qn(i)}))}function Kn(n){!function(n){const t=n.q.length>0&&n.q[0]<=n.S;n.fn&&t&&(sn(n),n.q.shift())}(n),fn(n),zn(n),function(n){const t=n.J.filter((t=>t.G<=n.S));n.J=n.J.filter((t=>t.G>n.S)),n.B.push(...t)}(n),function(n){for(const t of n.j)t.x=v(t.x,t.velocityX,0,n.F),t.M=_(t.M,t.Y,n.F)}(n),function(n){for(const t of n.B)t.x=v(t.x,t.velocityX,0,n.F),t.M=_(t.M,t.Y,n.F)}(n),function(n){const t=n.mn;(function(n){if(n.N)return;if(n.status!==s.o)return;const t=n.j.filter((n=>{const t=!n.O,e=n.I&&n.x>J+q,o=!n.I&&n.x+kn<J;return t&&(e||o)}));t.forEach((n=>n.O=!0)),n.mn+=t.length})(n),function(n){if(n.status!==s.o)return;const t=n.N?vn:bn,e=n.B.filter((t=>{const e=!t.O,o=x(n.T,t);return e&&o}));e.forEach((n=>n.O=!0)),n.B=n.B.filter((n=>!e.includes(n))),n.mn+=e.length*t}(n);const e=n.mn-t;for(let o=0;o<e;o++)n.gn((()=>{n.status===s.o&&(R(n.k,h(n.A.mn)),O(t+o+1))}))}(n),function(n){n.status===s.o?function(n){for(const t of n.j)if(x(n.T,t))return!0;return!1}(n)&&(!function(n){n.mn>n.ln&&(n.ln=n.mn,t=n.mn,localStorage.setItem(A,t));var t}(n),function(n){clearTimeout(n.L)}(n),function(n){n.sn=1}(n),dn(n),n.status=s.i,R(n.k,n.A.dn)):n.status===s.i&&function(n){return 0===n.j.length&&0===n.B.length}(n)&&(n.status=s.u,I(n.mn,n.ln))}(n),function(n){n.j=n.j.filter(M)}(n),function(n){n.B=n.B.filter(M)}(n),function(n){n.status===s.t&&an(n)&&!n.pn?n.pn=setTimeout((()=>{n.status===s.t&&(!function(){const n=H();Y(n),n.classList.add("spawn-and-shrug-bubble")}(),R(n.k,h(n.A.mn)))}),Jn):n.status!==s.u||n.hn||(n.hn=setTimeout((()=>{n.status===s.u&&(!function(){const n=L();Y(n),n.classList.add("spawn-and-shrug-bubble")}(),R(n.k,h(n.A.mn)))}),Jn))}(n),function(n){n.sn>0&&(n.sn-=n.F/Bn,n.sn<0&&(n.sn=0))}(n)}async function Wn(n){await async function(n){"suspended"!==n.k.state||n.wn||await n.k.resume()}(n),function(n){n.status===s.t&&an(n)?(n.status=s.o,n.H=n.yn??n.S,Hn(n),O(n.mn)):n.status===s.u&&(n.status=s.t,n.T=cn(),n.mn=0,n.U=(n.U+1)%qn,n.pn=null,n.hn=null,$n(n))}(n),sn(n),function(n){const t=n.S-n.T._;n.status===s.o&&t>U*Z&&(n.T.P=!0)}(n)}function Zn(n,t,e){const o=n.height,[u,c]=nt(t,e);n.width=u,n.height=c,function(n){n.B.map((t=>{t.y=i(n)-B/2-hn/2}))}(n),function(n){n.j.map((t=>{t.y=Gn(n)}))}(n),function(n,t){const e=i({height:t}),o=n.T.y,u=i(n);n.T.y=u-(e-o)}(n,o),X(n)}function nt(n,t){return[o,o*t/n]}function tt(n){n.stopPropagation()}function et(n,t){const[e,i]=P(),u=Math.floor(e*window.devicePixelRatio),c=Math.floor(i*window.devicePixelRatio),r=u/o;n.style.width=e+"px",n.style.height=i+"px",n.width=Math.floor(u),n.height=Math.floor(c),n.getContext("2d").scale(r,r),t&&Zn(t,n.width,n.height)}window.addEventListener("load",(async function(){const n=performance.now(),t=V(),e=document.querySelector(".info-button"),o=document.querySelector(".info-modal"),i=document.querySelector(".info-modal__card"),u=t.getContext("2d"),c=new AudioContext,{A:r,images:a}=await async function(n){const t={R:[],mn:[],V:[]},e=[k(n,"./sfx/die.mp3").then((n=>t.dn=n)),k(n,"./sfx/eat.wav").then((n=>t.xn=n)),k(n,"./sfx/jump-0.mp3").then((n=>t.R[0]=n)),k(n,"./sfx/jump-1.mp3").then((n=>t.R[1]=n)),k(n,"./sfx/jump-2.mp3").then((n=>t.R[2]=n)),k(n,"./sfx/jump-3.mp3").then((n=>t.R[3]=n)),k(n,"./sfx/jump-4.mp3").then((n=>t.R[4]=n)),k(n,"./sfx/jump-5.mp3").then((n=>t.R[5]=n)),k(n,"./sfx/score-0.wav").then((n=>t.mn[0]=n)),k(n,"./sfx/score-1.wav").then((n=>t.mn[1]=n)),k(n,"./sfx/score-2.wav").then((n=>t.mn[2]=n)),k(n,"./sfx/score-3.wav").then((n=>t.mn[3]=n)),k(n,"./sfx/shoot-0.wav").then((n=>t.V[0]=n)),k(n,"./sfx/shoot-1.wav").then((n=>t.V[1]=n))],o={T:[],an:[],background:[]},i=[T("./img/player-0.png").then((n=>o.T[0]=n)),T("./img/player-1.png").then((n=>o.T[1]=n)),T("./img/player-2.png").then((n=>o.T[2]=n)),T("./img/player-3.png").then((n=>o.T[3]=n)),T("./img/player-4.png").then((n=>o.T[4]=n)),T("./img/player-5.png").then((n=>o.T[5]=n)),T("./img/player-6.png").then((n=>o.T[6]=n)),T("./img/enemy-0.png").then((n=>o.an[0]=n)),T("./img/enemy-1.png").then((n=>o.an[1]=n)),T("./img/enemy-2.png").then((n=>o.an[2]=n)),T("./img/snack.png").then((n=>o.rn=n)),S("./img/background-0.png"),S("./img/background-1.png"),S("./img/background-2.png"),S("./img/background-3.png")];return await Promise.all([...e,...i]),{A:t,images:o}}(c),m=new URL(location),g="true"===m.searchParams.get("auto"),l="true"===m.searchParams.get("debug"),d="true"===m.searchParams.get("skip"),p="true"===m.searchParams.get("mute"),h="true"===m.searchParams.get("hungry"),w=m.searchParams.get("start"),y=m.searchParams.get("score"),x=m.searchParams.get("background"),M=w?Number.parseInt(w):void 0,b=y?Number.parseInt(y):0,v=x?Number.parseInt(x):1,_=localStorage.getItem(A)??0,[R,E]=P(),j=function(n,t,e,o,i,u,c,r,a,m,g,l,d,p){const[h,w]=nt(i,u);return{fn:r,cn:a,wn:m,N:g,yn:l,un:n,k:t,A:e,images:o,width:h,height:w,Z:0,$:0,S:0,F:0,tn:0,W:0,en:0,K:0,nn:0,status:s.t,mn:d,ln:c,T:cn(),j:[],C:[],B:[],J:[],q:[],H:0,gn:f(Un),Mn:null,L:null,X:null,pn:null,hn:null,sn:0,U:p}}(u,c,r,a,R,E,_,g,l,p,h,M,b,v),O=performance.now()-n;setTimeout((()=>{!function(n,t,e,o,i,u){et(e),Y(e),$n(n),requestAnimationFrame((t=>{n.$=0,n.Z=t,Qn(n)})),window.addEventListener("resize",(()=>et(e,n)),{passive:!0}),document.addEventListener("keydown",function(n){async function t(o){" "===o.key&&(await Wn(n),document.removeEventListener("keydown",t),document.addEventListener("keyup",e))}async function e(n){" "===n.key&&(document.removeEventListener("keyup",e),document.addEventListener("keydown",t))}return t}(n)),document.addEventListener("keydown",function(n){return t=>{"Escape"===t.key&&N(n)}}(i),{passive:!0}),document.addEventListener("visibilitychange",function(n,t){return()=>{!function(n,t){document.hidden?n.suspend():t.wn||n.resume()}(n,t)}}(t,n)),e.addEventListener("pointerup",function(n,t){async function e(){await Wn(t),n.addEventListener("pointerdown",o,{passive:!0})}async function o(){await Wn(t)}return e}(e,n),{once:!0,passive:!0}),o.addEventListener("click",function(n){function t(){Y(n)}return t}(i),{passive:!0}),i.addEventListener("click",function(n){function t(){N(n)}return t}(i),{passive:!0}),u.addEventListener("click",tt,{passive:!0})}(j,c,t,e,o,i)}),d?0:Math.max(2e3-O,0))}))}();
